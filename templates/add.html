{% extends 'base.html' %}
{% block title %}CleanDivide{% endblock %}
{%block custom_css %}
<link rel="stylesheet" href="{{ url_for('static', filename= 'css/add.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename= 'css/variables.css') }}">


{% endblock %}

{% block content %}

<div class="container">

    {% if template_data.task_table_exists %}
    <div class="row my-3">
    <!-- Content to display if a task_table exists for the user -->
        <p>A task table exists already but you can add more tasks or invite new house mates and then create a new one.
            Existing data can be deleted by following this <a href="{{ url_for('helpers_bp.viewdata')}}">link</a>
        </p>
    </div>
    {% else %}
    <div class="row my-3">
        <!-- Content to display if a task_table exists for the user -->
        <p>You have not created a table yet. Please add the required data and click the "Generate cleaning schedule" button, once it becomes available</p>
    </div>
{% endif %}


<div class="row">
    <a href="#" class="btn default-dashboard-button tooltip-button" id="btnAddTasks">Add Tasks <small>({{ template_data.tasks | length }} added)</small></a>
    <a href="#" class="btn default-dashboard-button ml-3 tooltip-button" id="btnInviteFlatmates">Invite Flatmates <small>({{ template_data.flatmates | length }} invited)</small></a>
    {% if template_data.flatmates|length == 0 or template_data.tasks|length < 2 %}
    <span data-bs-toggle="tooltip" data-bs-placement="top" title="Not enough flatmates or tasks added!" class=""><a href="" class="btn default-dashboard-button ml-3 tooltip-button disabled" >Cannot generate</a></span>
    {% else %}
    <a href="{{ url_for('generator_bp.generate') }}" class="btn default-dashboard-button ml-3 tooltip-button" data-tooltip="Let's go!">Generate cleaning schedule</a>
    {% endif %}
</div>

<hr class="bg-dark mt-5">

<div id="main-container">

    <!-- Adding flatmates into the DB -->
    <div class="row d-flex justify-content-center hidden" id="sectionFlatmates">

        <div class="row d-flex align-items-center justify-content-center">
    
            <div class="col-11 px-0 mx-0">
                <h1 class="">Add Flatmates</h1>
            </div>
            <!-- Left Side - Form Section -->
            <div class="col-12 col-lg-6 mt-2 p-5 add-flatmate-section">
                <!-- Note row -->
                <div class="row d-flex align-items-center justify-content-center">
                    <small>(Remember, they don't have to be your friends, just to do the tasks!)</small>
                </div>
                <!-- Form row -->
                <div class="row">
                    <form action="{{ url_for('additems_bp.add_flatmate') }}" method="post" class="col-12" id="emailForm">
                        <!-- Text Inputs -->
                        <div class="form-row d-flex align-items-center justify-content-center">
                            <input type="email" class="form-control col-10 mt-2" placeholder="Email of the flatmate" name="email" id="email" required>
                        </div>
                        
                        <!-- Buttons Row -->
                        <div class="form-row d-flex align-items-center justify-content-center mt-2">
                            <div class="col-10 px-0">
                                <input type="submit" value="Send invitation" class="btn default-dashboard-button w-100 px-0" />
                            </div>
                        </div>
                    </form>
                </div>
            </div>
    
            <!-- Right Side - Table or Alert Section -->
            <div class="col-12 col-lg-5 p-5 my-auto mx-2 add-flatmate-section">
                {% if template_data.flatmates|length > 0 %}
                    <h6 class="text-center">Flatmates added so far:</h6>
                    <table class="table table-striped">
                        <tbody>
                            {% for flatmate in template_data.flatmates %}
                                <tr>
                                    <td>{{ flatmate.email }}</td>
                                    <td>
                                        <form class="delete-form" action="{{ url_for('helpers_bp.delete_entry') }}" method="post">
                                            <input type="hidden" name="table_name" value="flatmates">
                                            <input type="hidden" name="id" value="{{ flatmate.id }}">
                                            <input type="submit" value="Delete">
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="d-flex align-items-center justify-content-center my-auto w-100 h-100">
                        <p class="text-center">You have not added any flatmates yet! Please note that probably, YOU CANNOT DO THIS ALONE!.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Adding tasks into the DB -->
    <div class="row d-flex justify-content-center" id="sectionTasks">
    
        <div class="row d-flex align-items-center justify-content-center">
            <div class="col-11 px-0 mx-0">
                <h1>Add Tasks</h1>
            </div>
            <!-- Left Side - Form Section -->
            <div class="col-12 col-lg-7 mt-2 p-5 add-tasks-section">
                <!-- Note row -->
                <div class="row d-flex align-items-center justify-content-center">
                    <small>(The most added 100 tasks are added as suggestions)</small>
                </div>
                <!-- Form row -->
                <div class="row">
                    <form action="{{ url_for('additems_bp.add_task') }}" method="post" class="col-12">
                        <!-- Text Input -->
                        <div class="form-row d-flex align-items-center justify-content-center">
                            <input list="popularTasks" type="text" name="description" maxlength="80" placeholder="Description of the task (max. 80 characters)" class="form-control" required>
                            <datalist id="popularTasks">
                                {% for task in template_data.popular_tasks %}
                                    <option value="{{ task.description }}">
                                {% endfor %}
                            </datalist>
                            <input type="number" name="points" min="1" max="20" placeholder="Difficulty of this task (1 - 20)" class="form-control mt-2" required />
                            <input name="room" placeholder="In what room is this task?" class="form-control mt-2" list="roomList" required />
                            <datalist id="roomList">
                                {% for room in template_data.rooms %}
                                    <option value="{{ room.name }}">
                                {% endfor %}
                            </datalist>
                            <input class="form-control mt-2" list="frequencies" id="frequency" name="frequency" placeholder="Frequency of this task"/>
                            <datalist id="frequencies">
                                <option value="Daily">
                                <option value="Twice weekly">
                                <option value="Weekly">
                                <option value="Twice monthly">
                                <option value="Monthly">
                                <option value="Yearly">
                            </datalist>
                        </div>
                            <!-- Add Task Button -->
                                <!-- Buttons Row -->
                            <div class="form-row d-flex justify-content-end mt-2">
                                <div class="col-12 px-0">
                                    <input type="submit" value="Add!" class="btn default-dashboard-button w-100 px-0" />
                                </div>
                            </div>
                    </form>
                </div>
            </div>
    
            <!-- Right Side - Table or Alert Section -->
            <div class="col-12 col-lg-4 p-5 my-auto mx-2 add-tasks-section">
                {% if template_data.tasks|length > 0 %}
                    <h6 class="text-center">Tasks added so far (last 6):</h6>
                    <table class="table table-striped">
                        <tbody>
                            {% for task in template_data.tasks[:6] %}
                                <tr>
                                    <td>{{ task.description }}</td>
                                    <td>{{ task.points }}</td>
                                    <td>
                                        <form action="{{ url_for('helpers_bp.delete_entry') }}" method="post">
                                            <input type="hidden" name="table_name" value="tasks">
                                            <input type="hidden" name="id" value="{{ task.id }}">
                                            <input type="submit" value="Delete">
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="d-flex align-items-center justify-content-center my-auto w-100 h-100">
                        <p class="text-center">There are no tasks added yet. But that's no problem, mold and cockroaches never killed anyone (allegedly)!</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

</div>

</div>



    {%block scripts %}

        <!-- JS variables -->
        <script type="text/javascript" src="{{ url_for('static', filename= 'js/add.js') }}"></script>
    {% endblock %}

{% endblock %}
