{% extends 'base.html' %}
{% block title %}CleanDivide{% endblock %}
{%block custom_css %}
<link rel="stylesheet" href="{{ url_for('static', filename= 'css/dashboard.css') }}">
{% endblock %}

{% block content %}


    {% if is_table_owner == 0 %}
        <div class="row col-12 d-flex justify-content-center align-items-center">
            <a href="{{ url_for('helpers_bp.become_house_master') }}" class="btn mx-2 rounded mx-auto" id="google-button">
                <i class="fa-brands fa-google fa-lg"></i> Become house master <small>(this cannot be undone)</small>
            </a>
        </div>
    {% endif %}

    {% if total_tasks == 0 %}
        <p>There is no calendar created yet. This usually means that you can continue procrastinating.</p>

    {% else %}

    <div class="row d-flex justify-content-end my-5">
        <a href="{{ url_for('dashboard_bp.dashboard_monthly') }}" method="post" class="btn default-dashboard-button">
            See next 30 days 
        </a>
        {% if is_table_owner %}
        <a href="{{ url_for('additems_bp.add_items') }}" class="btn default-dashboard-button">
            Generate a new table 
        </a>
        {% endif %}
    </div>


    <!-- Your Own Tasks Today -->
    <div class="container mt-5">
        <h1 class="text-center">Your Tasks for Today</h1>
        <h4 class="text-center text-muted mb-4">Table owner is {{ table_owner }}</h4>

        {% if own_tasks_today|length < 1 %}
            <p>Free as a bird! </p>
        {% else %}

        <table class="table table-bordered table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>ID</th>
                    <th>Description</th>
                    <th>Points</th>
                    <th>Frequency</th>
                    <th>Complete?</th>
                </tr>
            </thead>
            <tbody>
                {% for task in own_tasks_today %}
                <tr>
                    <td>{{ task["task_id"] }} </td>
                    <td>{{ task['task_description'] }}</td>
                    <td>{{ task['task_points'] }}</td>
                    <td>{{ task['task_frequency'] }}</td>
                    <td>
                        {% if task['task_complete'] == 1 %}
                            <span class="badge badge-success">Complete!</span>
                        {% else %}
                            <div class="d-flex flex-column">
                                <form action="{{ url_for('helpers_bp.mark_complete') }}" method="post" class="mb-1">
                                    <button class="btn btn-success btn-sm" type="submit" name="id" value="{{ task['id'] }}">
                                        Complete!
                                        <small class="d-block"><strong>( +{{ (task["task_points"] * 0.25) | floor }}...{{ (task["task_points"] * 0.75) | floor }} points)</strong></small>
                                    </button>
                                </form>
                                <form action="{{ url_for('helpers_bp.reassign_task') }}" method="post" class="mb-1">
                                    <button class="btn btn-danger btn-sm" type="submit" name="id" value="{{ task['id'] }}">Randomly reassign<br><small><strong>(- {{ power_costs["reassign"] }} points)</strong></small></button>
                                </form>
                                <form action="{{ url_for('helpers_bp.skip_task') }}" method="post" class="mb-1">
                                    <button class="btn btn-danger btn-sm" type="submit" name="id" value="{{ task['id'] }}">Just not do<br><small><strong>(- {{ power_costs["skip"] }} points)</strong></small></button>
                                </form>
                                <form action="{{ url_for('helpers_bp.procrastinate_task') }}" method="post">
                                    <button class="btn btn-info btn-sm" type="submit" name="id" value="{{ task['id'] }}">Leave it for tomorrow<br><small><strong>(- {{ power_costs["procrastinate"] }} points)</strong></small></button>
                                </form>
                            </div>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>


    <!-- Flatmates' Tasks Today -->
    <h1>Flatmates' Tasks for Today</h1>
    <table>
        <tr>
            <th>Task owner</th>
            <th>Description</th>
            <th>Status</th>
        </tr>
        {% for task in flatmates_tasks_today %}
    <tr>
        <td>{{ task['task_owner'] }}</td>
        <td>{{ task['task_description'] }}</td>
        <td>
            {% if task['task_complete'] == 1 %}
                Complete!
            {% else %}
                Incomplete!
            {% endif %}
        </td>
    </tr>
    {% endfor %}
    </table>

    <!-- Your Own Tasks for Tomorrow -->
    <h1>Your Tasks for Tomorrow</h1>
    <table>
        <tr>
            <th>Description</th>
            <th>Points</th>
            <th>Frequency</th>
        </tr>
        {% for task in own_tasks_tomorrow %}
        <tr>
            <td>{{ task['task_description'] }}</td>
            <td>{{ task['task_points'] }}</td>
            <td>{{ task['task_frequency'] }}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    {% if is_table_owner == 1 %}
    <h2>Points Assigned to Flatmates</h2>
    <h3>Flatmate Points</h3>
    <table>
        <thead>
            <tr>
                <th>Flatmate ID</th>
                <th>Total Points</th>
            </tr>
        </thead>
        <tbody>
            {% for flatmate in flatmates_points %}
            <tr>
                <td>{{ flatmate.task_owner }}</td>
                <td>{{ flatmate.total_points }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% endif %}


{% endblock %}



    {%block scripts %}
    <!-- <script src="{{ url_for('static', filename= 'js/datamanipulation.js') }}"></script> -->
    <script src="{{ url_for('static', filename= 'js/dashboard.js') }}"></script>

    <!-- JS variables -->
    <script type="text/javascript">
        // Define a JavaScript variable that holds the URL
    </script>

    

{% endblock %}
